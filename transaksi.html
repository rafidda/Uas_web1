<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Input Transaksi</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/styles.css">
    <style>
        .btn-custom {
            border-radius: 0;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease, transform 0.3s ease;
        }
        .btn-custom:hover {
            transform: scale(1.05);
        }
        .btn-blue {
            background-color: #007bff;
            color: #fff;
        }
        .btn-red {
            background-color: #dc3545;
            color: #fff;
        }
        .btn-orange {
            background-color: #10c21f;
            color: #fff;
        }
    </style>
</head>
<body>
    <!-- Navigasi -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top" style="background-color: #213555;">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html">
                <img src="assets/img/logo.png" alt="Logo" class="rounded-logo" style="width: 150px; height: 50px;">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link active" aria-current="page" href="index.html">Beranda</a></li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" id="navbarDropdown" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Transaksi</a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" href="transaksi.html">Input Transaksi</a></li>
                            <li><a class="dropdown-item" href="daftarTransaksi.html">Daftar Transaksi</a></li>
                        </ul>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="profil.html">Profil</a></li>
                </ul>
                <button class="btn btn-outline-light ms-3" type="button" id="authButton">Login</button>
            </div>
        </div>
    </nav>
    <!-- Header -->
    <header class="py-5 text-center">
        <div class="container px-4 px-lg-5 my-5">
            <h1 class="display-4 fw-bolder">Input Transaksi</h1>
            <p class="lead fw-normal mb-0">Masukkan detail transaksi Anda</p>
        </div>
    </header>
    <!-- Konten Utama -->
    <main class="py-5">
        <div class="container px-4 px-lg-5">
            <form id="transaksiForm" class="row g-3 mx-auto" style="max-width: 600px;">
                <div class="col-12">
                    <label for="nama" class="form-label">Nama:</label>
                    <input type="text" class="form-control" id="nama" name="nama" required>
                    <small class="form-text">inputkan nama anda</small>
                </div>
                <div class="col-12">
                    <label for="produk" class="form-label">Nama Produk:</label>
                    <input type="text" class="form-control" id="produk" name="produk" readonly>
                    <small class="form-text">Anda harus membeli produk di halaman beranda untuk mengisi form ini</small>
                </div>
                <div class="col-12">
                    <label for="harga" class="form-label">Harga:</label>
                    <input type="text" class="form-control" id="harga" name="harga" readonly>
                </div>
                <div class="col-12">
                    <label for="jumlah" class="form-label">Jumlah:</label>
                    <input type="number" class="form-control" id="jumlah" name="jumlah" min="1" max="99" required>
                    <small class="form-text">inputkan jumlah produk yang ingin anda beli</small>
                </div>
                <div class="col-12">
                    <label for="totalHarga" class="form-label">Total Harga:</label>
                    <input type="text" class="form-control" id="totalHarga" name="totalHarga" readonly>
                </div>
                <div class="col-12">
                    <label for="kodeTransaksi" class="form-label">Kode Transaksi:</label>
                    <input type="text" class="form-control" id="kodeTransaksi" name="kodeTransaksi" readonly>
                </div>
                <div class="col-12">
                    <label for="namaTransaksi" class="form-label">Nama Transaksi:</label>
                    <input type="text" class="form-control" id="namaTransaksi" name="namaTransaksi" readonly>
                </div>
                <div class="col-12">
                    <label for="alamat" class="form-label">Alamat:</label>
                    <textarea class="form-control" id="alamat" name="alamat" rows="3" required></textarea>
                    <small class="form-text">inputkan alamat anda</small>
                </div>
                <div class="col-12 text-center">
                    <button type="submit" class="btn btn-custom btn-blue">Simpan</button>
                    <button type="button" class="btn btn-custom btn-red" onclick="resetForm()">Hapus Form</button>
                    <button type="button" class="btn btn-custom btn-orange" onclick="redirectToHome()">Kembali Belanja</button>
                </div>
            </form>
        </div>
    </main>
    <!-- Footer -->
    <footer class="small-footer" style="background-color: #213555;">
        <div class="container"><p class="m-0 text-center text-white">&copy;arif rafida rahman - 241011700826 - ujian akhir semester pemrograman web 1.</p></div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Ambil data produk dan harga dari localStorage
            var produk = localStorage.getItem('produk');
            var harga = parseFloat(localStorage.getItem('harga'));

            // Isi form dengan data produk dan harga
            if (produk && harga) {
                document.getElementById('produk').value = produk;
                document.getElementById('harga').value = formatRupiah(harga);
            }

            document.getElementById('jumlah').addEventListener('input', function () {
                const jumlah = this.value;
                const totalHarga = jumlah * harga;
                document.getElementById('totalHarga').value = formatRupiah(totalHarga);
                const nama = document.getElementById('nama').value;
                document.getElementById('namaTransaksi').value = `${nama} membeli ${produk} total Rp ${formatRupiah(totalHarga)}`;
                generateKodeTransaksi(nama, produk);
            });

            document.getElementById('nama').addEventListener('input', function () {
                const nama = this.value;
                const jumlah = document.getElementById('jumlah').value;
                const totalHarga = jumlah * harga;
                document.getElementById('namaTransaksi').value = `${nama} membeli ${produk} total Rp ${formatRupiah(totalHarga)}`;
                generateKodeTransaksi(nama, produk);
            });

            document.getElementById('transaksiForm').addEventListener('submit', function (event) {
                event.preventDefault();
                const inputs = document.querySelectorAll('#transaksiForm input, #transaksiForm textarea');
                for (let input of inputs) {
                    if (!input.value) {
                        alert('Semua field harus diisi!');
                        return;
                    }
                }
                const transaksi = {
                    kodeTransaksi: document.getElementById('kodeTransaksi').value,
                    nama: document.getElementById('nama').value,
                    produk: document.getElementById('produk').value,
                    harga: document.getElementById('harga').value,
                    jumlah: document.getElementById('jumlah').value,
                    alamat: document.getElementById('alamat').value,
                    namaTransaksi: document.getElementById('namaTransaksi').value,
                    totalHarga: document.getElementById('totalHarga').value
                };
                saveTransaksi(transaksi);
                window.location.href = 'daftarTransaksi.html';
            });

            window.addEventListener('beforeunload', function () {
                document.getElementById('transaksiForm').reset();
                localStorage.removeItem('produk');
                localStorage.removeItem('harga');
            });

            function generateKodeTransaksi(nama, produk) {
                const randomNum = Math.floor(10000 + Math.random() * 90000);
                const kodeTransaksi = `${nama.charAt(0)}${produk.charAt(produk.length - 1)}${randomNum}`;
                document.getElementById('kodeTransaksi').value = kodeTransaksi;
            }

            function formatRupiah(angka) {
                return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR' }).format(angka);
            }

            function saveTransaksi(transaksi) {
                let transaksiList = JSON.parse(localStorage.getItem('transaksiList')) || [];
                transaksiList.push(transaksi);
                localStorage.setItem('transaksiList', JSON.stringify(transaksiList));
            }

            // Tampilkan tombol logout jika sudah login
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            const authButton = document.getElementById('authButton');
            if (isLoggedIn === 'true') {
                authButton.textContent = 'Logout';
                authButton.onclick = function() {
                    localStorage.removeItem('isLoggedIn');
                    localStorage.removeItem('username');
                    localStorage.removeItem('transaksiList'); // Reset data transaksi
                    window.location.href = 'login.html';
                };
            } else {
                authButton.textContent = 'Login';
                authButton.onclick = function() {
                    window.location.href = 'login.html';
                };
            }
        });

        function resetForm() {
            document.getElementById('transaksiForm').reset();
        }

        function redirectToHome() {
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
