<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daftar Transaksi</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light" style="background-color: #213555;">
        <div class="container px-4 px-lg-5">
            <a href="index.html" class="navbar-brand" href="#">
                <img src="assets/img/logo.png" alt="Logo" class="rounded-logo" style="width: 150px; height: 50px;">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0 ms-lg-4">
                    <li class="nav-item"><a class="nav-link active" href="index.html" style="color: #f0f0f0;">Beranda</a></li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" id="navbarDropdown" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="color: #f0f0f0;">Transaksi</a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" href="transaksi.html">Input Transaksi</a></li>
                            <li><a class="dropdown-item" href="daftarTransaksi.html">Daftar Transaksi</a></li>
                        </ul>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="profil.html" style="color: #f0f0f0;">Profil</a></li>
                </ul>
                <form class="d-flex navbar-right">
                    <button class="btn btn-outline-light" type="button" id="authButton">Login</button>
                </form>
            </div>
        </div>
    </nav>
    <!-- Header -->
    <header class="py-5 text-center">
        <div class="container px-4 px-lg-5 my-5">
            <h1 class="display-4 fw-bolder">Daftar Transaksi</h1>
            <p class="lead fw-normal mb-0">Berikut adalah daftar transaksi Anda</p>
        </div>
    </header>
    <!-- Main Content -->
    <main class="py-5">
        <div class="container-fluid px-2">
            <div class="table-responsive">
                <table class="table table-striped table-bordered text-center">
                    <thead class="table-dark">
                        <tr>
                            <th scope="col">No</th>
                            <th scope="col">Kode Transaksi</th>
                            <th scope="col">Nama</th>
                            <th scope="col">Nama Produk</th>
                            <th scope="col" style="width: 200px;">Harga</th>
                            <th scope="col">Jumlah</th>
                            <th scope="col">Alamat</th>
                            <th scope="col">Nama Transaksi</th>
                            <th scope="col" style="width: 200px;">Total Harga</th>
                            <th scope="col">Hapus</th>
                        </tr>
                    </thead>
                    <tbody id="transaksiTableBody">
                        <!-- Data transaksi akan dimuat secara otomatis -->
                    </tbody>
                    <tfoot class="table-dark">
                        <tr>
                            <td colspan="8" class="text-end">Total Keseluruhan:</td>
                            <td id="totalKeseluruhan"></td>
                            <td></td>
                        </tr>
                        <tr id="paymentInstructionRow" style="display: none;">
                            <td colspan="10" class="text-center text-white" id="paymentInstruction"></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
            <div class="text-center mt-4">
                <button class="btn btn-success" onclick="confirmCheckout()">Checkout</button>
            </div>
        </div>
    </main>
    <!-- Footer -->
    <footer class="small-footer" style="background-color: #213555;">
        <div class="container">
            <p class="m-0 text-center text-white">&copy;arif rafida rahman - 241011700826 - ujian akhir semester pemrograman web 1.</p>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            loadTransaksi();
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            const authButton = document.getElementById('authButton');
            if (isLoggedIn === 'true') {
                authButton.textContent = 'Logout';
                authButton.onclick = function() {
                    localStorage.removeItem('isLoggedIn');
                    localStorage.removeItem('username');
                    localStorage.removeItem('transaksiList'); // Reset transaction data
                    clearTransactionTable(); // Clear transaction table
                    window.location.href = 'index.html';
                };
            } else {
                authButton.textContent = 'Login';
                authButton.onclick = function() {
                    window.location.href = 'login.html';
                };
            }
        });

        function loadTransaksi() {
            const transaksiList = JSON.parse(localStorage.getItem('transaksiList')) || [];
            const transaksiTableBody = document.getElementById('transaksiTableBody');
            transaksiTableBody.innerHTML = ''; // Hapus data sebelumnya
            let totalKeseluruhan = 0;

            transaksiList.forEach((transaksi, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${transaksi.kodeTransaksi}</td>
                    <td>${transaksi.nama}</td>
                    <td>${transaksi.produk}</td>
                    <td>${transaksi.harga}</td>
                    <td>${transaksi.jumlah}</td>
                    <td>${transaksi.alamat}</td>
                    <td>${transaksi.namaTransaksi}</td>
                    <td>${transaksi.totalHarga}</td>
                    <td><button class="btn btn-danger btn-sm" onclick="hapusTransaksi(${index})"><i class="fas fa-trash-alt"></i></button></td>
                `;
                transaksiTableBody.appendChild(row);

                // Tambahkan totalHarga ke totalKeseluruhan
                const totalHargaNumeric = parseFloat(transaksi.totalHarga.replace(/[^0-9.-]+/g, ""));
                totalKeseluruhan += isNaN(totalHargaNumeric) ? 0 : totalHargaNumeric;
            });

            // Tampilkan total keseluruhan dengan format Rupiah dan tambahkan enam angka 0 dibelakangnya dengan titik memisahkan
            document.getElementById('totalKeseluruhan').innerText = formatRupiah(totalKeseluruhan) + '.000.000,00';
        }

        function hapusTransaksi(index) {
            const transaksiList = JSON.parse(localStorage.getItem('transaksiList')) || [];
            transaksiList.splice(index, 1);
            localStorage.setItem('transaksiList', JSON.stringify(transaksiList));
            loadTransaksi();
        }

        function confirmCheckout() {
            if (confirm('Yakin ingin checkout?')) {
                checkout();
                document.getElementById('paymentInstructionRow').style.display = 'table-row';
            }
        }

        function checkout() {
            const totalKeseluruhan = document.getElementById('totalKeseluruhan').innerText;
            const transaksiList = JSON.parse(localStorage.getItem('transaksiList')) || [];
            const kodeTransaksi = transaksiList.map(transaksi => transaksi.kodeTransaksi).join('');
            const paymentInstruction = `Pembayaran anda adalah ${totalKeseluruhan}. Silahkan bayar di outlet kami dengan kode bayar ${kodeTransaksi}.`;
            document.getElementById('paymentInstruction').innerText = paymentInstruction;
        }

        function formatRupiah(angka) {
            return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(angka);
        }

        function clearTransactionTable() {
            const transaksiTableBody = document.getElementById('transaksiTableBody');
            transaksiTableBody.innerHTML = ''; // Hapus data sebelumnya
            document.getElementById('totalKeseluruhan').innerText = ''; // Hapus total keseluruhan
        }
    </script>
</body>
</html>